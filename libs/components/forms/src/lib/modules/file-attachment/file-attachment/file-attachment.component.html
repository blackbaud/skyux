<div class="sky-file-attachment-wrapper">
  <div
    class="sky-file-attachment-label-wrapper"
    [attr.id]="labelElementId"
    [ngClass]="{
      'sky-control-label-required':
        !labelText && isRequired && hasLabelComponent
    }"
  >
    @if (labelText) {
      @if (!labelHidden) {
        <span
          class="sky-control-label sky-margin-inline-xs"
          [ngClass]="{
            'sky-control-label-required': isRequired
          }"
          >{{ labelText }}</span
        >
      }

      @if (helpPopoverContent || helpKey) {
        <sky-help-inline
          [labelText]="labelText"
          [helpKey]="helpKey"
          [popoverTitle]="helpPopoverTitle"
          [popoverContent]="helpPopoverContent"
        />
      }
    } @else {
      <ng-content select="sky-file-attachment-label" />
    }

    @if (isRequired && (hasLabelComponent || labelText)) {
      <span class="sky-screen-reader-only">{{
        'skyux_file_attachment_required' | skyLibResources
      }}</span>
    }
  </div>
  <div
    class="sky-file-attachment-upload sky-file-attachment sky-file-attachment-target"
    [ngClass]="{
      'sky-file-attachment-accept': acceptedOver,
      'sky-file-attachment-reject': rejectedOver
    }"
    (dragenter)="fileDragEnter($event)"
    (dragover)="fileDragOver($event)"
    (dragleave)="fileDragLeave($event)"
    (drop)="fileDrop($event)"
  >
    <input
      hidden
      tabindex="-1"
      type="file"
      [attr.accept]="acceptedTypes || null"
      [disabled]="disabled"
      [required]="isRequired"
      (change)="fileChangeEvent($event)"
      #fileInput
    />

    @if (showFileAttachmentButton) {
      <button
        class="sky-file-attachment-btn sky-btn sky-btn-default"
        type="button"
        skyId
        [attr.aria-describedby]="
          (hintText ? hintTextRef.id + ' ' : '') + fileDropDescriptionRef.id
        "
        [attr.aria-label]="
          value
            ? ('skyux_file_attachment_button_label_replace_file_label'
              | skyLibResources: fileName)
            : ('skyux_file_attachment_button_label_choose_file_label'
              | skyLibResources)
        "
        [attr.aria-labelledby]="
          attachButton.id +
          ' ' +
          (labelText
            ? labelElementId
            : hasLabelComponent
              ? labelComponents?.get(0)?.labelContentId?.id
              : undefined)
        "
        [disabled]="disabled"
        (click)="onDropClicked()"
        #attachButton="skyId"
      >
        <sky-icon icon="folder-open-o" />
        {{
          value
            ? ('skyux_file_attachment_button_label_replace_file'
              | skyLibResources)
            : ('skyux_file_attachment_button_label_choose_file'
              | skyLibResources)
        }}
      </button>
    }

    @if (value && !isImage && currentThemeName === 'modern') {
      <sky-icon
        class="sky-file-attachment-icon sky-deemphasized"
        icon="file-o"
        size="2x"
      />
    }

    @if (value || currentThemeName === 'default') {
      <span class="sky-file-attachment-name">
        <a
          *ngIf="value; else noFile"
          [attr.title]="fileName"
          (click)="emitClick()"
        >
          {{ truncatedFileName }}
        </a>
      </span>
    }
    <ng-template #noFile>
      <span class="sky-file-attachment-none sky-deemphasized">
        {{ 'skyux_file_attachment_label_no_file_chosen' | skyLibResources }}
      </span>
    </ng-template>
    <button
      *ngIf="value"
      class="sky-btn sky-btn-borderless sky-file-attachment-delete"
      skyId
      type="button"
      [attr.aria-label]="
        'skyux_file_attachment_file_item_remove' | skyLibResources: fileName
      "
      [attr.aria-labelledby]="
        deleteButton.id +
        ' ' +
        (hasLabelComponent
          ? labelComponents?.get(0)?.labelContentId?.id
          : undefined)
      "
      [disabled]="disabled"
      [skyThemeClass]="{
        'sky-btn-icon-borderless': 'modern'
      }"
      (click)="deleteFileAttachment()"
      #deleteButton="skyId"
    >
      <sky-icon icon="trash-o" size="md" />
    </button>
  </div>

  <img
    *ngIf="value && isImage"
    class="sky-file-attachment-preview-img"
    [alt]="
      'skyux_file_attachment_file_upload_image_preview_alt_text'
        | skyLibResources
    "
    [src]="value.url"
  />
</div>
<div skyId #hintTextRef="skyId">
  <div
    *ngIf="hintText"
    class="sky-font-deemphasized sky-file-attachment-hint-text"
  >
    {{ hintText }}
  </div>
</div>

<sky-form-errors
  *ngIf="labelText && (ngControl?.control?.errors || fileErrorValidation)"
  [id]="errorId"
  [errors]="
    ngControl?.errors !== null ? ngControl?.errors : fileErrorValidation
  "
  [labelText]="labelText"
  [showErrors]="ngControl?.touched || ngControl?.dirty"
>
  <ng-content select="sky-form-error" />
  <sky-form-error
    *ngIf="fileErrorName === 'fileType'"
    [errorName]="'fileType'"
    [errorText]="
      acceptedTypesErrorMessage ??
        'skyux_file_attachment_file_type_error_label_text'
        | skyLibResources: fileErrorParam
    "
  />
  @if (fileErrorName === 'maxFileSize') {
    <sky-form-error
      [errorName]="'maxFileSize'"
      [errorText]="
        'skyux_file_attachment_max_file_size_error_label_text'
          | skyLibResources: (fileErrorParam | skyFileSize)
      "
    />
  }
  @if (fileErrorName === 'minFileSize') {
    <sky-form-error
      [errorName]="'minFileSize'"
      [errorText]="
        'skyux_file_attachment_min_file_size_error_label_text'
          | skyLibResources: (fileErrorParam | skyFileSize)
      "
    />
  }
</sky-form-errors>

<span
  aria-hidden="true"
  class="sky-screen-reader-only"
  role="tooltip"
  skyId
  #fileDropDescriptionRef
>
  {{ 'skyux_file_attachment_file_upload_drag_or_click' | skyLibResources }}
</span>
