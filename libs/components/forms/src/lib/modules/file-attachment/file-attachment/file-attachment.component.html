<div class="sky-file-attachment-wrapper">
  <div
    #labelRef="skyId"
    class="sky-file-attachment-label-wrapper"
    skyId
    [ngClass]="{
      'sky-control-label-required':
        !labelText && isRequired && hasLabelComponent
    }"
  >
    <ng-container *ngIf="labelText; else labelContent">
      <span
        *ngIf="!labelHidden"
        class="sky-control-label sky-margin-inline-xs"
        [ngClass]="{
          'sky-control-label-required': isRequired
        }"
        >{{ labelText }}</span
      ><sky-help-inline
        *ngIf="helpPopoverContent || helpKey"
        [labelText]="labelText"
        [helpKey]="helpKey"
        [popoverTitle]="helpPopoverTitle"
        [popoverContent]="helpPopoverContent"
      />
    </ng-container>
    <span
      class="sky-screen-reader-only"
      *ngIf="isRequired && (hasLabelComponent || labelText)"
      >{{ 'skyux_file_attachment_required' | skyLibResources }}</span
    >
  </div>
  <div
    class="sky-file-attachment-upload sky-file-attachment sky-file-attachment-target"
    [ngClass]="{
      'sky-file-attachment-accept': acceptedOver,
      'sky-file-attachment-reject': rejectedOver
    }"
    (dragenter)="fileDragEnter($event)"
    (dragover)="fileDragOver($event)"
    (dragleave)="fileDragLeave($event)"
    (drop)="fileDrop($event)"
  >
    <div
      #fileDropDescriptionRef="skyId"
      aria-hidden="true"
      class="sky-screen-reader-only"
      role="tooltip"
      skyId
    >
      {{ 'skyux_file_attachment_file_upload_drag_or_click' | skyLibResources }}
    </div>
    <input
      #fileInputRef
      hidden
      tabindex="-1"
      type="file"
      [attr.accept]="acceptedTypes || null"
      [disabled]="disabled"
      [required]="isRequired"
      (change)="fileChangeEvent($event)"
    />
    <ng-container *ngIf="showFileAttachmentButton">
      <button
        *ngIf="showFileAttachmentButton"
        class="sky-file-attachment-btn sky-btn sky-btn-default"
        type="button"
        [attr.aria-describedby]="
          hintText && hintTextEl.id
            | skyFileAttachmentJoinIds: fileDropDescriptionRef.id
        "
        [attr.aria-labelledby]="
          attachButtonLabelRef.id
            | skyFileAttachmentJoinIds
              : (labelText
                  ? labelRef.id
                  : labelComponents?.get(0)?.labelContentId?.id)
        "
        [disabled]="disabled"
        (click)="onDropClicked()"
      >
        <sky-icon icon="folder-open-o" />
        {{
          value
            ? ('skyux_file_attachment_button_label_replace_file'
              | skyLibResources)
            : ('skyux_file_attachment_button_label_choose_file'
              | skyLibResources)
        }}
      </button>
    </ng-container>
    <sky-icon
      *ngIf="value && !isImage && currentThemeName === 'modern'"
      class="sky-file-attachment-icon sky-deemphasized"
      icon="file-o"
      size="2x"
    />
    <span
      *ngIf="value || currentThemeName === 'default'"
      class="sky-file-attachment-file-link"
    >
      <a
        *ngIf="value; else noFileRef"
        [href]="isData ? value.url : undefined"
        [download]="isData ? value.file.name : undefined"
        [attr.title]="fileName"
        (click)="emitClick()"
      >
        {{ truncatedFileName }}
      </a>
    </span>
    <ng-template #noFileRef>
      <span class="sky-file-attachment-none sky-deemphasized">
        {{ 'skyux_file_attachment_label_no_file_chosen' | skyLibResources }}
      </span>
    </ng-template>
    <button
      *ngIf="value"
      class="sky-btn sky-btn-borderless sky-file-attachment-delete"
      type="button"
      [attr.aria-labelledby]="
        deleteButtonLabelRef.id
          | skyFileAttachmentJoinIds
            : labelComponents?.get(0)?.labelContentId?.id
      "
      [disabled]="disabled"
      [skyThemeClass]="{
        'sky-btn-icon-borderless': 'modern'
      }"
      (click)="deleteFileAttachment()"
    >
      <sky-icon icon="trash-o" size="md" />
    </button>
  </div>

  <img
    *ngIf="value && isImage"
    class="sky-file-attachment-preview-img"
    [alt]="
      'skyux_file_attachment_file_upload_image_preview_alt_text'
        | skyLibResources
    "
    [src]="value.url"
  />
</div>
<div skyId #hintTextEl="skyId">
  <div
    *ngIf="hintText"
    class="sky-font-deemphasized sky-file-attachment-hint-text"
  >
    {{ hintText }}
  </div>
</div>

<sky-form-errors
  [id]="errorId"
  [labelText]="labelText"
  [showErrors]="ngControl?.touched || ngControl?.dirty"
>
  @if (ngControl?.errors?.['required']) {
    <sky-form-error
      errorName="required"
      [errorText]="'skyux_form_error_required' | skyLibResources: labelText"
    />
  }

  <sky-form-error
    *ngIf="fileErrorName === 'fileType'"
    [errorName]="'fileType'"
    [errorText]="
      acceptedTypesErrorMessage ??
        'skyux_file_attachment_file_type_error_label_text'
        | skyLibResources: fileErrorParam
    "
  />
  <sky-form-error
    *ngIf="fileErrorName === 'maxFileSize'"
    [errorName]="'maxFileSize'"
    [errorText]="
      'skyux_file_attachment_max_file_size_error_label_text'
        | skyLibResources: (fileErrorParam | skyFileSize)
    "
  />
  <sky-form-error
    *ngIf="fileErrorName === 'minFileSize'"
    [errorName]="'minFileSize'"
    [errorText]="
      'skyux_file_attachment_min_file_size_error_label_text'
        | skyLibResources: (fileErrorParam | skyFileSize)
    "
  />

  <ng-content select="sky-form-error" />
</sky-form-errors>

<ng-template #labelContent>
  <ng-content select="sky-file-attachment-label" />
</ng-template>

<span
  #attachButtonLabelRef="skyId"
  aria-hidden="true"
  class="sky-screen-reader-only"
  skyId
>
  {{
    value
      ? ('skyux_file_attachment_button_label_replace_file_label'
        | skyLibResources: fileName)
      : ('skyux_file_attachment_button_label_choose_file_label'
        | skyLibResources)
  }}
</span>

<span
  #deleteButtonLabelRef="skyId"
  aria-hidden="true"
  class="sky-screen-reader-only"
  skyId
>
  {{ 'skyux_file_attachment_file_item_remove' | skyLibResources: fileName }}
</span>
